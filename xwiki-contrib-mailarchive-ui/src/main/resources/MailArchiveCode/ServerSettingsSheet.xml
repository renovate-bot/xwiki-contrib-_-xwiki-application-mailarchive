<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>MailArchiveCode</web>
  <name>ServerSettingsSheet</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>MailArchiveCode.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1353930107000</creationDate>
  <date>1354528933000</date>
  <contentUpdateDate>1354528933000</contentUpdateDate>
  <version>1.1</version>
  <title>#if($doc.name == 'ServerSettingsSheet')ServerSettings Sheet#{else}$services.display.title($doc, {'displayerHint': 'default'})#end</title>
  <template/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{velocity}}
#set($obj = $doc.getObject('MailArchiveCode.ServerSettingsClass'))
#if($request.get('submit'))
DEBUG $services.mailarchive
  #set($nb = $services.mailarchive.check("${doc.fullName}"))
  $obj.set('status', $nb)
  $obj.set('lasttest', $datetool.get('dd/MM/yyyy HH:mm:ss'))
  $doc.save("tested connection status : $nb")
#end

#if($context.action != "edit")
{{html}}
#startfloatingbox()
  #if(!$obj.status || "$!obj.status" == "")
Connection never tested.
  #else
    #set($nb = $util.parseInteger($obj.get('status')))
    #if($nb &gt;= 0)
There were $obj.get('status') messages to read on $obj.get('lasttest')
    #else
Connection failed, tested on $obj.get('lasttest')
    #end
  #end
#if($doc.checkAccess('edit'))
&lt;form action="" class="xform" method="post" name="form_test_connection"&gt;
  &lt;input class="button" type="submit" name="submit" value="Test Connection"/&gt;
&lt;/form&gt;
#end
#endfloatingbox()
{{/html}}
#end

#set($class = $obj.xWikiClass)
{{html wiki="true"}}
&lt;form action="." class="xform" name="form_server"&gt;
#foreach($prop in $class.properties)
  #if("$prop.name" != "status" &amp;&amp; "$prop.name" != "lasttest") 
  &lt;dl&gt;
    &lt;dt&gt;&lt;label for="MailArchiveCode.ServerSettingsClass_0_$prop.name"&gt;$prop.prettyName&lt;/label&gt;&lt;/dt&gt;
    &lt;dd&gt;$doc.display($prop.getName())&lt;/dd&gt;
  &lt;/dl&gt;
  #end
#end
&lt;/form&gt;
{{/html}}

#if($request.get('submit'))
  #if ($nb &gt;= 0)

{{info}}$msg.get('mailarchive.servers.connectionStatus.description.ok', [$nb]){{/info}}

  #else

{{error}}$msg.get("mailarchive.servers.connectionStatus.description.${nb}"){{/error}}

  #end
  #if($nb &lt; 0)

    {{info}}[[Javamail FAQ&gt;&gt;http://www.oracle.com/technetwork/java/faq-135477.html]] can be interesting reading{{/info}}

  #end
#end

{{/velocity}}</content>
</xwikidoc>
