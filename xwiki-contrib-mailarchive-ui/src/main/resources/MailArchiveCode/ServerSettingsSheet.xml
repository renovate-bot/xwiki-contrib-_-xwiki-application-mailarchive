<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>MailArchiveCode</web>
<name>ServerSettingsSheet</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>MailArchiveCode.ServerSettingsClass</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1353417892000</creationDate>
<date>1353417892000</date>
<contentUpdateDate>1353417892000</contentUpdateDate>
<version>1.1</version>
<title>#if($doc.name == 'ServerSettingsSheet')ServerSettings Sheet#{else}$services.display.title($doc, {'displayerHint': 'default'})#end</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment>Import</comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.1</syntaxId>
<hidden>false</hidden>
<content>{{velocity}}
#set($obj = $doc.getObject('MailArchiveCode.ServerSettingsClass'))
#if($request.get('submit'))
DEBUG $services.mailarchive
  #set($nb = $services.mailarchive.check("${doc.fullName}"))
  $obj.set('status', $nb)
  $obj.set('lasttest', $datetool.get('dd/MM/yyyy HH:mm:ss'))
  $doc.save("tested connection status : $nb")
#end

#if($context.action != "edit")
{{html}}
#startfloatingbox()
  #if(!$obj.status || "$!obj.status" == "")
Connection never tested.
  #else
    #set($nb = $util.parseInteger($obj.get('status')))
    #if($nb &gt;= 0)
There were $obj.get('status') messages to read on $obj.get('lasttest')
    #else
Connection failed, tested on $obj.get('lasttest')
    #end
  #end
#if($doc.checkAccess('edit'))
&lt;form action="" class="xform" method="post" name="form_test_connection"&gt;
  &lt;input class="button" type="submit" name="submit" value="Test Connection"/&gt;
&lt;/form&gt;
#end
#endfloatingbox()
{{/html}}
#end

#set($class = $obj.xWikiClass)
{{html wiki="true"}}
&lt;form class="xform"&gt;
#foreach($prop in $class.properties)
  #if("$prop.name" != "status" &amp;&amp; "$prop.name" != "lasttest") 
  &lt;dl&gt;
    &lt;dt&gt;&lt;label for="MailArchiveCode.ServerSettingsClass_0_$prop.name"&gt;$prop.prettyName&lt;/label&gt;&lt;/dt&gt;
    &lt;dd&gt;$doc.display($prop.getName())&lt;/dd&gt;
  &lt;/dl&gt;
  #end
#end
&lt;/form&gt;
{{/html}}

#if($request.get('submit'))
  #if ($nb &gt;= 0)

    {{info}}Successfully connected, there are ${nb} messages to be read from this server{{/info}}

  #elseif ($nb == -1)

    {{error}}Authentication failed, check your account settings, or need for a specific certificate for Javamail{{/error}}

  #elseif ($nb == -2)

    {{error}}Could not connect to this server, check logs for more details{{/error}}

  #elseif ($nb == -3)

    {{error}}Illegal state, maybe a previous connection was not properly closed{{/error}}

  #elseif ($nb == -4)

    {{error}}Unexpected exception occurred, check logs for more details{{/error}}

  #elseif ($nb == -5)

    {{error}}Folder was not found, check it exists and is correctly spelled{{/error}}

  #elseif ($nb == -6)

    {{error}}Unknown host : check host name is correctly spelled, and that this host is accessible from this server{{/error}}

  #else

    {{error}}An unknown error occurred, check logs for more details{{/error}}

  #end
  #if($nb &lt; 0)

    {{info}}[[Javamail FAQ&gt;&gt;http://www.oracle.com/technetwork/java/faq-135477.html]] can be interesting reading{{/info}}

  #end
#end

{{/velocity}}</content></xwikidoc>
