<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>MailArchiveCode</web>
  <name>LoadingSheet2</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>MailArchiveCode.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1361964224000</creationDate>
  <date>1361974137000</date>
  <contentUpdateDate>1361974137000</contentUpdateDate>
  <version>1.1</version>
  <title>LoadingSheet2</title>
  <template/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{velocity wiki="true"}}
#set($installed = $services.mailarchive)
$installed
$services.mailarchive.getConfig()
#set($config = $services.mailarchive.config)
#if(!$config)
  #set($installed = false)
#end
#if(!$installed)
DEBUG CONFIG $config
  Mail Archive is not correctly installed, please check [[Admin page&gt;&gt;MailArchive.Admin]].
#else
  ## Create default loading session if needed
  #set($defaultsessiondoc = $xwiki.getDocument('MailArchivePrefs.LoadingSession_default'))
  #set($defaultsession = $defaultsessiondoc.getObject('MailArchiveCode.LoadingSessionClass'))
  #if(!$xwiki.exists('MailArchivePrefs.LoadingSession_default') || $defaultsession.id != 'default')
    #set($defaultsession = $defaultsessiondoc.newObject('MailArchiveCode.LoadingSessionClass'))
$msession
    #set($discard = $msession.set('id', 'default'))
    #set($discard = $msession.set('maxMailsNb', '-1'))
    #set($discard = $msession.set('withDelete', '0'))
    #set($discard = $msession.set('loadAll', '0'))
    #set($discard = $msession.set('debugMode', '1'))
    #set($discard = $msession.set('simulationMode', '1'))
    #set($discard = $msession.set('recentMails', '0'))
    #set($discard = $defaultsessiondoc.save('Created default loading session.'))
  #end

{{html wiki="true"}}

$services.localization.render('mailarchive.load.abstract')

= Sources =

  #set($sources = $config.servers)
  #set($sources = $sorttool.sort($sources, ["type", "id"]))
  #if($sources.size() &gt; 0)
    #set($total = 0)
|= |=Type|=$services.localization.render('mailarchive.load.table.headers.server')|=State|=Status
    #foreach($source in $sources)
      #set($currentsource = $source[0])
      #set($nb=$util.parseInteger($currentsource.status))
      #if($nb &lt; 0) 
        #set($status = $services.localization.render("mailarchive.servers.connectionStatus.${nb}"))
      #else
        #set($status = "$nb")
        #set($total = $total + $nb)
      #end
|&lt;input type="radio" name="radiosources" value="$source.id"&gt;|$source.type|[[$source.id / $source.folder&gt;&gt;$source.wikiDoc]]|$source.state|$status
    #end
|&lt;input type="radio" name="radiosources" value="all"&gt;|SERVER|All Servers|$total|/
&lt;div id="buttons_sources"&gt;
  &lt;span class="buttonwrapper"&gt;
    &lt;input type="submit" id="button-sources-check" name="button-sources-check" $!disabled 
value="Check"/&gt;
    &lt;input type="submit" id="button-sources-load" name="button-sources-load" $!disabled value="Load"/&gt;
  &lt;/span&gt;
&lt;/div&gt;
  #end


= Loading Sessions =

Go to [[Scheduler job page&gt;&gt;Scheduler.MailArchiveLoadingJob]] to activate / deactivate automatic loading.
Scheduled job, once activated, will automatically load mails from servers in ACTIVE state, using the parameters below:&lt;br/&gt;&lt;br/&gt;

|=Parameter|=Value
|$services.localization.render('mailarchive.loadingSession.fields.maxMailsNb.label')|$ssession.maxMailsNb
|$services.localization.render('mailarchive.loadingSession.fields.debugMode.label')|$ssession.debugMode
|$services.localization.render('mailarchive.loadingSession.fields.simulationMode.label')|$ssession.simulationMode
|$services.localization.render('mailarchive.loadingSession.fields.loadAll.label')|$ssession.loadAll
|$services.localization.render('mailarchive.loadingSession.fields.recentMails.label')|$ssession.recentMails
|$services.localization.render('mailarchive.loadingSession.fields.withDelete.label')|$ssession.withDelete

&lt;br/&gt;&lt;br/&gt;

&lt;div class="buttons_schedule"&gt;
  &lt;span class="buttonwrapper"&gt;
    &lt;input type="submit" id="button-scheduleparams" name="button-scheduleparams" $!disabled value="Use parameters from top of this page for scheduled job"/&gt;
  &lt;/span&gt;
&lt;/div&gt;

#end

{{/html}}
{{/velocity}}</content>
</xwikidoc>
