<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>MailArchiveTests</web>
  <name>MonitorJob</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent/>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1380288979000</creationDate>
  <date>1381083256000</date>
  <contentUpdateDate>1381083256000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{velocity output="false"}}
## NOTE: We don't use #template because it currently registers the Velocity macros in a different namespace which makes
## them unavailable in the current wiki page or the current template. We also tried #parse but it "randomly" fails to
## register the Velocity macros from the parsed template. The only solution we found is to use #evaluate with #include
## but unfortunately this doesn't allow the template to be overridden from the skin.
#evaluate("#include('extension.vm')")
{{/velocity}}

{{velocity}}
{{html clean="false"}}

#set($job = $services.mailarchive.getCurrentJob())
#if($job.type == "mailarchivejob")
Job type $job.type
$job.status.state - Success $job.nbSuccess / Failure $job.nbFailure
Offsets $job.status.progress.offset

#displayJobProgressBar($job.status)
  &lt;div id="extension-body-progress" class="extension-body-progress loading" style="display:block";&gt;
#printStatusLog($job.status)
  &lt;/div&gt;

#end

&lt;script type="text/javascript"&gt;
Event.observe(window, 'load', function() {
var loadingLogItem = $('extension-body-progress').down('.extension-log-item-loading');
            if (loadingLogItem) {
              var log = loadingLogItem.up();
              log.scrollTop = log.scrollHeight;
            }
});
&lt;/script&gt;

{{/html}}
{{/velocity}}</content>
</xwikidoc>
