<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>MailArchive</web>
  <name>Admin</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>MailArchive.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1353930098000</creationDate>
  <date>1354528935000</date>
  <contentUpdateDate>1354528935000</contentUpdateDate>
  <version>1.1</version>
  <title>Mail Archive Administration</title>
  <template/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <object>
    <class>
      <name>MailArchiveCode.AdminClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <adv_croptopicid>
        <customDisplay/>
        <defaultValue/>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>adv_croptopicid</name>
        <number>15</number>
        <prettyName>Crop topic IDs to 30 characters</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </adv_croptopicid>
      <adv_itemsspace>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>adv_itemsspace</name>
        <number>16</number>
        <picker>0</picker>
        <prettyName>Space to store new items</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>MailArchiveItems|MailArchive|MailArchive_${server_id}</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </adv_itemsspace>
      <createmissingprofiles>
        <customDisplay/>
        <defaultValue>0</defaultValue>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>createmissingprofiles</name>
        <number>9</number>
        <prettyName>Create missing wiki profiles</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </createmissingprofiles>
      <defaulthomeview>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>defaulthomeview</name>
        <number>13</number>
        <picker>0</picker>
        <prettyName>Default view for Homepage</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>table=Table|timeline=Timeline</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </defaulthomeview>
      <defaulttopicsview>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>defaulttopicsview</name>
        <number>11</number>
        <picker>0</picker>
        <prettyName>Default view for Topics</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>threads=Threaded messages|forum=Forum|list=List</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </defaulttopicsview>
      <emailignoredtext>
        <customDisplay/>
        <disabled>0</disabled>
        <name>emailignoredtext</name>
        <number>19</number>
        <picker>0</picker>
        <prettyName>Text to ignore when matching emails</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </emailignoredtext>
      <excelexport>
        <customDisplay/>
        <defaultValue/>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType/>
        <name>excelexport</name>
        <number>14</number>
        <prettyName>Export to Excel link in livetables</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </excelexport>
      <ldapphoto>
        <customDisplay/>
        <defaultValue/>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>ldapphoto</name>
        <number>5</number>
        <prettyName>Import photo from LDAP ?</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </ldapphoto>
      <ldapphotofield>
        <customDisplay/>
        <disabled>0</disabled>
        <name>ldapphotofield</name>
        <number>6</number>
        <picker>0</picker>
        <prettyName>LDAP Photo Field Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </ldapphotofield>
      <ldapphotoforceupdate>
        <customDisplay/>
        <defaultValue/>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>ldapphotoforceupdate</name>
        <number>11</number>
        <prettyName>Force Update</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </ldapphotoforceupdate>
      <ldapphototype>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>ldapphototype</name>
        <number>7</number>
        <picker>0</picker>
        <prettyName>LDAP Photo Field Content</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>binary=Image Binary Content|url=Image URL</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </ldapphototype>
      <mailsopeningmode>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>mailsopeningmode</name>
        <number>12</number>
        <picker>0</picker>
        <prettyName>Default method for opening Mail messages from Topics</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>popup=Pop-up window|inline=In same page|newpage=In new page</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </mailsopeningmode>
      <matchldap>
        <customDisplay/>
        <defaultValue>0</defaultValue>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>matchldap</name>
        <number>8</number>
        <prettyName>Match LDAP users</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </matchldap>
      <matchwikiprofiles>
        <customDisplay/>
        <defaultValue>1</defaultValue>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>matchwikiprofiles</name>
        <number>7</number>
        <prettyName>Link mails authors with Wiki profiles</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </matchwikiprofiles>
      <ratings>
        <customDisplay/>
        <defaultValue>0</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType/>
        <name>ratings</name>
        <number>17</number>
        <prettyName>Show ratings ?</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </ratings>
      <store>
        <customDisplay/>
        <defaultValue/>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>store</name>
        <number>18</number>
        <prettyName>Use local store</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </store>
      <timeline>
        <customDisplay/>
        <defaultValue/>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>timeline</name>
        <number>3</number>
        <prettyName>Manage a TimeLine ?</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </timeline>
      <timelinemaxload>
        <customDisplay/>
        <disabled>0</disabled>
        <name>timelinemaxload</name>
        <number>14</number>
        <numberType>long</numberType>
        <prettyName>Number of topics to load in timeline</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
      </timelinemaxload>
      <user>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>user</name>
        <number>1</number>
        <picker>0</picker>
        <prettyName>Loading user</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators/>
        <size>6</size>
        <sort>value</sort>
        <unmodifiable>0</unmodifiable>
        <usesList>1</usesList>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
      </user>
    </class>
    <name>MailArchive.Admin</name>
    <number>0</number>
    <className>MailArchiveCode.AdminClass</className>
    <guid>d60a5b0b-06fe-4f44-9241-6069b7b81e2f</guid>
    <property>
      <createmissingprofiles>0</createmissingprofiles>
    </property>
    <property>
      <defaulthomeview>table</defaulthomeview>
    </property>
    <property>
      <defaulttopicsview>list</defaulttopicsview>
    </property>
    <property>
      <excelexport/>
    </property>
    <property>
      <ldapphoto>0</ldapphoto>
    </property>
    <property>
      <ldapphotofield/>
    </property>
    <property>
      <ldapphotoforceupdate>0</ldapphotoforceupdate>
    </property>
    <property>
      <ldapphototype>binary</ldapphototype>
    </property>
    <property>
      <mailsopeningmode>popup</mailsopeningmode>
    </property>
    <property>
      <matchldap>0</matchldap>
    </property>
    <property>
      <matchwikiprofiles>1</matchwikiprofiles>
    </property>
    <property>
      <timeline>1</timeline>
    </property>
    <property>
      <timelinemaxload>100</timelinemaxload>
    </property>
    <property>
      <user/>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.ConfigurableClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <codeToExecute>
        <disabled>0</disabled>
        <editor>---</editor>
        <name>codeToExecute</name>
        <number>7</number>
        <picker>0</picker>
        <prettyName>codeToExecute</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </codeToExecute>
      <configurationClass>
        <disabled>0</disabled>
        <name>configurationClass</name>
        <number>3</number>
        <picker>0</picker>
        <prettyName>configurationClass</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </configurationClass>
      <configureGlobally>
        <defaultValue/>
        <disabled>0</disabled>
        <displayFormType>checkbox</displayFormType>
        <displayType/>
        <name>configureGlobally</name>
        <number>4</number>
        <prettyName>configureGlobally</prettyName>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </configureGlobally>
      <displayInSection>
        <disabled>0</disabled>
        <name>displayInSection</name>
        <number>1</number>
        <picker>0</picker>
        <prettyName>displayInSection</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </displayInSection>
      <heading>
        <disabled>0</disabled>
        <name>heading</name>
        <number>2</number>
        <picker>0</picker>
        <prettyName>heading</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </heading>
      <iconAttachment>
        <disabled>0</disabled>
        <name>iconAttachment</name>
        <number>8</number>
        <picker>0</picker>
        <prettyName>iconAttachment</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </iconAttachment>
      <linkPrefix>
        <disabled>0</disabled>
        <name>linkPrefix</name>
        <number>5</number>
        <picker>0</picker>
        <prettyName>linkPrefix</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </linkPrefix>
      <propertiesToShow>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>propertiesToShow</name>
        <number>6</number>
        <picker>0</picker>
        <prettyName>propertiesToShow</prettyName>
        <relationalStorage>1</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>20</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values/>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </propertiesToShow>
    </class>
    <name>MailArchive.Admin</name>
    <number>0</number>
    <className>XWiki.ConfigurableClass</className>
    <guid>8ae861d0-d8a3-4c22-89dd-e92c2ca738f5</guid>
    <property>
      <codeToExecute/>
    </property>
    <property>
      <configurationClass>MailArchiveCode.AdminClass</configurationClass>
    </property>
    <property>
      <configureGlobally>1</configureGlobally>
    </property>
    <property>
      <displayInSection>mailarchive</displayInSection>
    </property>
    <property>
      <heading>Mail Archive</heading>
    </property>
    <property>
      <iconAttachment/>
    </property>
    <property>
      <linkPrefix/>
    </property>
    <property>
      <propertiesToShow/>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.TagClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <tags>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>tags</name>
        <number>1</number>
        <prettyName>Tags</prettyName>
        <relationalStorage>1</relationalStorage>
        <separator>|</separator>
        <separators>|,</separators>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <values/>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </tags>
    </class>
    <name>MailArchive.Admin</name>
    <number>0</number>
    <className>XWiki.TagClass</className>
    <guid>3169f02d-3889-4222-b4b5-a0d60c9d51e6</guid>
    <property>
      <tags/>
    </property>
  </object>
  <content>{{velocity wiki="true"}}
#set($status = $request.get('status'))
#set($message = $request.get('message'))
#if("$!status" == "ok")
{{info}}$message{{/info}}
#end
#if("$!status" == "ko")
{{error}}$message{{/error}}
#end
#set($ok = $xwiki.jsfx.use("/js/xwiki/lightbox/lightbox.js", true))
#set($ok = $xwiki.ssfx.use("js/xwiki/lightbox/lightbox.css", true))
#set($spacecode='MailArchiveCode')
#set($spaceitems='MailArchiveItems')
#set($spacehome='MailArchive')
#set($spaceprefs='MailArchivePrefs')
#if (!$xwiki.exists("${spaceprefs}.GlobalParameters"))
  #set($prefsdoc = $xwiki.getDocument("${spaceprefs}.GlobalParameters"))
  #set($prefsobj = $prefsdoc.newObject("${spacecode}.AdminClass"))
  #set($ok = $prefsdoc.save())
#end 
#if (!$xwiki.exists("${spaceprefs}.Type_Mail"))
  #set($mailtypedoc = $xwiki.getDocument("${spaceprefs}.Type_Mail"))
  #set($mailtypeobj = $mailtypedoc.newObject("${spacecode}.TypesSettingsClass"))
  #set($discard=$mailtypeobj.set('id', 'mail'))
  #set($discard=$mailtypeobj.set('name', 'Mail'))
  #set($discard=$mailtypeobj.set('icon', 'email'))
  #set($discard=$mailtypeobj.set('builtin', '1'))
  #set($ok = $mailtypedoc.save())
#end
#if(!$xwiki.exists("${spaceprefs}.Type_Calendar"))
  #set($mailcalendardoc = $xwiki.getDocument("${spaceprefs}.Type_Calendar"))
  #set($mailcalendarobj = $mailcalendardoc.newObject("${spacecode}.TypesSettingsClass"))
  #set($discard = $mailcalendarobj.set('id', 'calendar'))
  #set($discard = $mailcalendarobj.set('name', 'Calendar Entry'))
  #set($discard = $mailcalendarobj.set('icon', 'calendar'))
  #set($discard = $mailcalendarobj.set('builtin', '1'))
  #set($ok = $mailcalendardoc.save())
#end
#if($!request.save)
  #set($prefsdoc = $xwiki.getDocument("${spaceprefs}.GlobalParameters"))
  #set($prefsobj=$prefsdoc.updateObjectFromRequest("${spacecode}.AdminClass"))
  #set($ok=$prefsdoc.save())
  #if($ok)
    //Saved//
  #else
    //Failed to save parameters//
  #end
#end
#set($xwql="select count(topics) from Document doc, doc.object('MailArchiveCode.MailTopicClass') as topics where doc.space='$spaceitems'")
#set($result=$xwiki.queryManager.xwql($xwql).execute())
#set($nbTopics=$result[0])
#set($xwql="select count(mails) from Document doc, doc.object('MailArchiveCode.MailClass') as mails where doc.space='$spaceitems'")
#set($result=$xwiki.queryManager.xwql($xwql).execute())
#set($nbMails=$result[0])
#set($xwql="select count(servers) from Document doc, doc.object('MailArchiveCode.ServerSettingsClass') as servers where doc.space='$spaceprefs'")
#set($result=$xwiki.queryManager.xwql($xwql).execute())
#set($nbServers=$result[0])
#set($xwql="select count(stores) from Document doc, doc.object('MailArchiveCode.StoreClass') as stores where doc.space='$spaceprefs'")
#set($result=$xwiki.queryManager.xwql($xwql).execute())
#set($nbStores=$result[0])
#set($xwql="select count(lists) from Document doc, doc.object('MailArchiveCode.ListsSettingsClass') as lists where doc.space='$spaceprefs'")
#set($result=$xwiki.queryManager.xwql($xwql).execute())
#set($nbLists=$result[0])
#set($xwql="select count(types) from Document doc, doc.object('MailArchiveCode.TypesSettingsClass') as types where doc.space='$spaceprefs'")
#set($result=$xwiki.queryManager.xwql($xwql).execute())
#set($nbTypes=$result[0])
#set($prerequisites = 1)
#if (!$xwiki.exists('Macro.TabsMacro'))  {{error}}Missing pre-requisite : please install [[Tabs Macro&gt;&gt;http://extensions.xwiki.org/xwiki/bin/view/Extension/Tabs+Macro]]{{/error}}  #set($prerequisites = 0) #end
#if(!$xwiki.exists("XWiki.LiveTableResultsMacros"))  {{warning}}The LiveTable component is not installed properly. If you are running XWiki 1.8.x, you will need to download the LiveTable component from http://extensions.xwiki.org{{/warning}}  #set($prerequisites = 0) #end
#if($prerequisites == 1) {{tabs idsToLabels='tabIdSummary=Summary,tabIdGlobalParameters=Global Parameters,tabIdCorporateFeatures=Enterprise Features,tabIdMailServers=Sources ($nbServers),tabIdLists=Mailing-Lists ($nbLists),tabIdTypes=Mail Types ($nbTypes),tabIdAdvanced=Advanced Parameters' /}}

{{html wiki="true"}}
(%id="tabIdSummary"%)(((
* Number of topics : **$nbTopics**
* Number of mails : **$nbMails**
* Number of configured servers : #if($nbServers==0) (% style="color:red" %) #end **$nbServers**
* Number of configured stores : **$nbStores**
* Number of configured mailing-lists : #if($nbLists==0) (% style="color:red" %) #end **$nbLists**
#set($prefsdoc = $xwiki.getDocument("${spaceprefs}.GlobalParameters"))
#set($prefs = $prefsdoc.getObject("${spacecode}.AdminClass"))
#set($loadingUser = $prefs.get('user'))
#if("$!loadingUser" == "") 

{{warning}}Please set a loading user in 'Global Parameters' !{{/warning}}

#else
* Loading user : $!loadingUser
#end
#if("$!msg.mailarchive_home_title"=="") ## does not work ? || !$xwiki.hasAccessLevel("edit", $loadinguser, "${spacehome}.WebHome"))

{{warning}}Please visit [[Install&gt;&gt;MailArchiveCode.Install]] page to finish installation{{/warning}}

#end #if (!$xwiki.exists('Macros.AddExcelExportToLivetableMacro'))

{{info}}Install [[AddExcelExportToLivetable Macro&gt;&gt;http://extensions.xwiki.org/xwiki/bin/view/Extension/LiveTableExcelExport+Macro]] to add related feature.{{/info}}

#end #if(!$xwiki.ratings || !$xwiki.exists('XWiki.Ratings'))

{{info}}Install [[Ratings Application&gt;&gt;http://extensions.xwiki.org/xwiki/bin/view/Extension/Ratings+Application]] and [[Ratings Plugin&gt;&gt;http://extensions.xwiki.org/xwiki/bin/view/Extension/Ratings+Plugin]] to add related feature.
{{/info}}

#end #if($nbServers == 0) 

{{warning}}Please configure at least one mail server{{/warning}}

#end
#if($nbLists == 0)

{{warning}}Please configure at least one mailing-list{{/warning}}

#end #if($scheduled)

{{warning}}Please schedule the crontab job{{/warning}}

#end
)))
(%id="tabIdGlobalParameters"%)(((
&lt;form action="" class="xform" method="post" name="form_admin"&gt;
#set($prop=$xwiki.getPropertyClassFromName("MailArchiveCode.AdminClass_user"))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_user"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;It is recommended to create a specific user for the Mail Archive, with edit rights on MailArchive and MailArchiveCode spaces, and to give only read rights to other users to these spaces.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName("MailArchiveCode.AdminClass_defaulthomeview"))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_defaulthomeview"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;"Timeline" option is meaningful only if "timeline" property is set below.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_defaulttopicsview'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_defaulttopicsview"&gt;$prop.getPrettyName()&lt;/label&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_mailsopeningmode'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_mailsopeningmode"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;Affects the way mails are displayed when clicked from a Topic view.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_excelexport'))
   &lt;dl&gt;
     &lt;dt&gt;
      &lt;label for="MailArchiveCode.AdminClass_0_excelexport"&gt;$prop.getPrettyName()&lt;/label&gt;
#if (!$xwiki.exists('Macros.AddExcelExportToLivetableMacro'))
      &lt;span class="xErrorMsg"&gt;You need to install [[the export to Excel macro&gt;&gt;http://extensions.xwiki.org/xwiki/bin/view/Extension/LiveTableExcelExport+Macro]] to use this feature.&lt;/span&gt;
     &lt;/dt&gt;
#else
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), $mode) Add 'export to Excel' link to the Mail Archive livetables
     &lt;/dd&gt;
#end
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_ratings'))
   &lt;dl&gt;
     &lt;dt&gt;
      &lt;label for="MailArchiveCode.AdminClass_0_ratings"&gt;$prop.getPrettyName()&lt;/label&gt;
#if (!$xwiki.exists('XWiki.Ratings') || !$xwiki.ratings)
      &lt;span class="xErrorMsg"&gt;You need to install Ratings Plugin and Ratings Applications to use this feature.&lt;/span&gt;
     &lt;/dt&gt;
#else
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), $mode) Show ratings in Topics and Mails views.
     &lt;/dd&gt;
#end
   &lt;/dl&gt;

#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_timeline'))
   &lt;dl&gt;
     &lt;dt&gt;
      &lt;label for="MailArchiveCode.AdminClass_0_timeline"&gt;$prop.getPrettyName()&lt;/label&gt;
      &lt;span class="xHint"&gt;The MailArchive Timeline shows bands for last topics in a timeline. Uses a [[Simile widget&gt;&gt;http://www.simile-widgets.org/timeline/]]. Timeline data is generated and cached after each loading session (if any mail was loaded). Can slightly slow down loading sessions.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') Compute timeline data when new mails are loaded, and add option for timeline view in Mail Archive homepage
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_timelinemaxload'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_timelinemaxload"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;A number in range [1..500]. Large values show more history in timeline but can lead to big computation time and resources usage on server. Default is 100.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_matchwikiprofiles'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_matchwikiprofiles"&gt;$prop.getPrettyName()&lt;/label&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') Match wiki profiles using email addresses of authors, and set "created by", "updated by" fields accordingly in created wiki pages.
     &lt;/dd&gt;
   &lt;/dl&gt;
#if($hasEdit)
&lt;span class="buttonwrapper"&gt;
  &lt;input class="button" type="submit" name="save" value="Save"/&gt;
&lt;/span&gt;
#end
&lt;/form&gt;
)))

(%id="tabIdCorporateFeatures"%)
(((
&lt;form action="" class="xform" method="post" name="form_corporatefeatures"&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_emailignoredtext'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_emailignoredtext"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;For specific emails part, for example if provided text is "-external", both emails "john.smith@yahoo.com" and "john.smith-external@yahoo.com" will be matched. Note : domain part (here "yahoo") is always ignored.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_matchldap'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_matchldap"&gt;$prop.getPrettyName()&lt;/label&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') Check existence of mail authors from LDAP using email addresses or login information.
     &lt;/dd&gt;
   &lt;/dl&gt;
&lt;div id="synchro_fields" style="margin-left:20px;"&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_createmissingprofiles'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_createmissingprofiles"&gt;$prop.getPrettyName()&lt;/label&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') If an account exists in LDAP but not as wiki profile, create the wiki user profile from LDAP information.
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_ldapphoto'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_ldapphoto"&gt;$prop.getPrettyName()&lt;/label&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') Retrieve a photo from LDAP and assign it as avatar to matching wiki profile
     &lt;/dd&gt;
   &lt;/dl&gt;
&lt;div id="ldap_photo_fields" class="hidden" style="margin-left:40px;"&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_ldapphotoforceupdate'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_ldapphotofield"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;By default, does not update wiki profile avatar (or even retrieve photo from LDAP) if it already exists.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') Force update of wiki profile photo from LDAP.
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_ldapphotofield'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_ldapphotofield"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;The LDAP field name supposed to contain user picture information.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_ldapphototype'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_ldapphototype"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;The expected content of the LDAP photo field name. This field could contain an URL targeting the picture, or directly binary data of the picture (only JPEG format is recognized).&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
&lt;/div&gt;
&lt;/div&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_store'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_store"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') Create a backup copy of emails to local store
     &lt;/dd&gt;
   &lt;/dl&gt;
#if($hasEdit)
&lt;span class="buttonwrapper"&gt;
  &lt;input class="button" type="submit" value="Save"/&gt;
&lt;/span&gt;
#end
&lt;/form&gt;
)))

(%id="tabIdMailServers"%)(((
{{include reference="MailArchiveCode.AdminMailSourcesSheet"/}}
)))
(%id="tabIdLists"%)(((
{{include reference="MailArchiveCode.AdminListsSheet"/}}
)))
(%id="tabIdTypes"%)(((
Types are useful to materialize standard mails, annoucements, releases, ...&lt;br/&gt;

Mail types are similar to mailing-lists above, except that information is persisted in tags and in a specific mail field ("type"), a specific icon can be associated with each type. This information is viewable in Mails and Topics pages, and in the Timeline view (topic icon). 
You can use a regular expression as pattern, and pick the fields to be checked against this pattern.&lt;br/&gt;

Some built-in types exist, for them only icon can be updated. They are stored in a specific "builtin type" mail field.&lt;br/&gt;

Note : icon field should contain the name of an icon from [[XWiki Icon Set&gt;&gt;http://www.famfamfam.com/lab/icons/silk/previews/index_abc.png]].&lt;br/&gt;&lt;br/&gt;

&lt;i&gt;Default type 'Mail' should not be deleted nor updated (except to set another icon if you wish)&lt;/i&gt;&lt;br/&gt;

#set($collist = [ "id", "builtin", "name", "icon", "_actions"])
#set($colprops = {                   
                   "id" : { "type" : "text", "link" : "view" },
                   "builtin" : { "type" : "text" },
                   "name" : { "type" : "text", "link" : "view" },
                   "icon" : { "type" : "html" },
                   "_actions" : {"actions": ["edit","delete"] } 
                 } )
#set($options = { "className":"MailArchiveCode.TypesSettingsClass",
                  "resultPage":"MailArchiveCode.LiveTableResults",
                  "selectedColumn":"name",
                  "tagCloud":"false",
                  "defaultOrder":"asc",
                  "translationPrefix" : "mailarchive.types.table.headers.",
                  "rowCount": 10,
                  "extraParams" : "&amp;space=MailArchivePrefs" })
#livetable("livetable_types" $collist $colprops $options)
&lt;form action="#" class="xformInline" method="post" name="form_types"&gt;
  &lt;span class="buttonwrapper"&gt;
    &lt;a href="#" class="button" id="btAddType"&gt;Add...&lt;/a&gt;
  &lt;/span&gt;
&lt;/form&gt;
)))
(%id="tabIdAdvanced"%)(((
You should probably not modify the following parameters. They are mainly available for specific use-cases and for compatibility reasons.
Do not update them without thinking of the consequences !
&lt;form action="" class="xform" method="post" name="form_advanced"&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_adv_croptopicid'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_adv_croptopicid"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;Compatibility option, you should leave it unchecked.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit') Crop topic IDs
     &lt;/dd&gt;
   &lt;/dl&gt;
#set($prop=$xwiki.getPropertyClassFromName('MailArchiveCode.AdminClass_adv_itemsspace'))
   &lt;dl&gt;
     &lt;dt&gt;
       &lt;label for="MailArchiveCode.AdminClass_0_itemsspace"&gt;$prop.getPrettyName()&lt;/label&gt;
       &lt;span class="xHint"&gt;By default all items created pages are stored in MailArchiveItems space wich is fine, but you can decide to put them in MailArchive (beware with purge not to delete home page and others), or in a specific space per server, using server unique ID. If you update a server ID, the space won't be renamed, only new items will be stored in newly named space.&lt;br/&gt;You should probably use the default value.&lt;/span&gt;
     &lt;/dt&gt;
     &lt;dd&gt;
       $prefsdoc.display($prop.getName(), 'edit')
     &lt;/dd&gt;
   &lt;/dl&gt;
#if($hasEdit)
&lt;span class="buttonwrapper"&gt;
  &lt;input class="button" type="submit" name="save" value="Save"/&gt;
&lt;/span&gt;
#end
&lt;/form&gt;
)))

{{/html}}

#else

{{info}}Please add missing pre-requisites in order to use this application !{{/info}}

#end

{{/velocity}}

{{velocity wiki="true"}}
{{html wiki="false"}}
&lt;script type="text/javascript"&gt;
var serversurl = "$xwiki.getDocument('MailArchiveCode.ServersSettingsCreation').getURL('view')";
var storesurl = "$xwiki.getDocument('MailArchiveCode.StoreCreation').getURL('view')";
var listsurl = "$xwiki.getDocument('MailArchiveCode.ListsSettingsCreation').getURL('view')";
var typesurl = "$xwiki.getDocument('MailArchiveCode.TypesSettingsCreation').getURL('view')";
var homeurl = "$xwiki.getDocument('MailArchive.Admin').getURL('view')"
var tab = "${request.get('tab')}";

// onload events and included javascript
Event.observe(window, "load", onLoad);
var sync_field = document.getElementById('MailArchiveCode.AdminClass_0_matchldap');
Event.observe(sync_field, 'change', toggleSyncUserMode);
var ldapphoto_field = document.getElementById('MailArchiveCode.AdminClass_0_ldapphoto');
Event.observe(ldapphoto_field, 'click', toggleLdapPhoto);
Event.observe($('btAddServer'), 'click', openAddServer);
Event.observe($('btAddStore'), 'click', openAddStore); //openAddItem.bindAsEventListener(this, storesurl));
Event.observe($('btAddList'), 'click', openAddList);
Event.observe($('btAddType'), 'click', openAddType);
function toggleSyncUserMode() {
  var val = sync_field.checked;
  if (val) {
    rmClass($('synchro_fields'), 'hidden');
  } else {
    if(!eltHasClass($('synchro_fields'),'hidden')) {
      $('synchro_fields').className+=" hidden";
    }
  }
}
function setStatusInsideDiv(divid, status) {
  var div = document.getElementById(divid);
  var elms = div.getElementsByTagName("*");
  for(var i = 0, maxI = elms.length; i &lt; maxI; ++i) {
    var elm = elms[i];
    elm.enabled = status;
  }
}
function toggleLdapPhoto() {
  var val = ldapphoto_field.checked;
  if (val) {
    rmClass($('ldap_photo_fields'), 'hidden');
  } else {
    if(!eltHasClass($('ldap_photo_fields'),'hidden')) {
      $('ldap_photo_fields').className+=" hidden";
    }
  }
}
function openAddItem(event, url) {
  var createurl = url + '?xpage=plain';
  var saveurl = url + '?save=true&amp;xpage=plain&amp;outputSyntax=plain';
  var redirecturl = homeurl;
  window.lb = new Lightbox(createurl,saveurl,redirecturl);
}
function openAddServer() {
  var createurl = serversurl + '?xpage=plain';
  var saveurl = serversurl + '?save=true&amp;xpage=plain&amp;outputSyntax=plain';
  var redirecturl = homeurl;
  window.lb = new Lightbox(createurl,saveurl,redirecturl);
}
function openAddStore() {
  var createurl = storesurl + '?xpage=plain';
  var saveurl = storesurl + '?save=true&amp;xpage=plain&amp;outputSyntax=plain';
  var redirecturl = homeurl;
  window.lb = new Lightbox(createurl,saveurl,redirecturl);
}
function openAddList() {
  var createurl = listsurl + '?xpage=plain';
  var saveurl = listsurl + '?save=true&amp;xpage=plain&amp;outputSyntax=plain';
  var redirecturl = homeurl;
  window.lb = new Lightbox(createurl,saveurl,redirecturl);
}
function openAddType() {
  var createurl = typesurl + '?xpage=plain';
  var saveurl = typesurl + '?save=true&amp;xpage=plain&amp;outputSyntax=plain';
  var redirecturl = homeurl;
  window.lb = new Lightbox(createurl,saveurl,redirecturl);
}

function onLoad() {
  toggleSyncUserMode();
  toggleLdapPhoto();
  if (tab == 'sources') {
    switchTab('tabIdMailServers', ['tabIdSummary', 'tabIdGlobalParameters', 'tabIdCorporateFeatures', 'tabIdMailServers', 'tabIdLists', 'tabIdTypes', 'tabIdAdvanced']);
  }
  if (tab == 'lists') {
    switchTab('tabIdLists', ['tabIdSummary', 'tabIdGlobalParameters', 'tabIdCorporateFeatures', 'tabIdMailServers', 'tabIdLists', 'tabIdTypes', 'tabIdAdvanced']);
  }
  if (tab == 'types') {
    switchTab('tabIdTypes', ['tabIdSummary', 'tabIdGlobalParameters', 'tabIdCorporateFeatures', 'tabIdMailServers', 'tabIdLists', 'tabIdTypes', 'tabIdAdvanced']);
  }
}
&lt;/script&gt;
{{/html}}
{{/velocity}}</content>
</xwikidoc>
